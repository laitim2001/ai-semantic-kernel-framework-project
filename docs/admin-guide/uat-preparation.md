# IPA Platform 用戶驗收測試 (UAT) 準備指南

本指南提供 IPA Platform 用戶驗收測試的完整準備流程、測試場景和反饋收集機制。

---

## 目錄

1. [UAT 概述](#uat-概述)
2. [UAT 環境部署](#uat-環境部署)
3. [測試場景](#測試場景)
4. [用戶培訓](#用戶培訓)
5. [測試執行](#測試執行)
6. [反饋收集](#反饋收集)
7. [Sign-off 流程](#sign-off-流程)

---

## UAT 概述

### 目的

用戶驗收測試 (UAT) 是在系統上線前，由業務用戶驗證系統是否滿足業務需求的最終測試階段。

### 範圍

| 模組 | 測試重點 |
|------|----------|
| 工作流管理 | 創建、編輯、版本控制 |
| 執行引擎 | 觸發、監控、錯誤處理 |
| Agent 服務 | AI 回應、工具調用 |
| 審批流程 | 檢查點、審批通知 |
| 監控告警 | Dashboard、告警配置 |
| 用戶管理 | RBAC、審計日誌 |

### 時間表

| 階段 | 時間 | 活動 |
|------|------|------|
| 準備 | 第 1 天 | 環境部署、用戶培訓 |
| 執行 | 第 2-4 天 | 測試執行、問題記錄 |
| 修復 | 第 5-6 天 | Bug 修復、重測 |
| Sign-off | 第 7 天 | 最終驗證、簽核 |

### 參與人員

| 角色 | 人數 | 職責 |
|------|------|------|
| 業務用戶 | 3-5 | 執行測試場景 |
| 產品負責人 | 1 | 解答業務問題 |
| QA 工程師 | 1 | 協助測試、記錄問題 |
| 開發人員 | 2 | 修復問題、技術支援 |
| DevOps | 1 | 環境維護 |

---

## UAT 環境部署

### 環境規格

```yaml
# UAT 環境配置
environment:
  name: uat
  url: https://uat.ipa-platform.com

resources:
  backend:
    replicas: 2
    cpu: "1000m"
    memory: "2Gi"

  frontend:
    replicas: 2
    cpu: "500m"
    memory: "1Gi"

  database:
    instance: "Standard_D2s_v3"
    storage: "50GB"

  redis:
    sku: "Standard"
    capacity: 1
```

### 部署步驟

#### 1. 創建 UAT 命名空間

```bash
# Kubernetes
kubectl create namespace ipa-uat

# 設置資源配額
kubectl apply -f - <<EOF
apiVersion: v1
kind: ResourceQuota
metadata:
  name: uat-quota
  namespace: ipa-uat
spec:
  hard:
    requests.cpu: "4"
    requests.memory: "8Gi"
    limits.cpu: "8"
    limits.memory: "16Gi"
EOF
```

#### 2. 部署數據庫

```bash
# 使用生產數據的匿名化副本
pg_dump -h $PROD_DB_HOST -U $DB_USER -d ipa_platform \
  --data-only \
  | python scripts/anonymize_data.py \
  | psql -h $UAT_DB_HOST -U $DB_USER -d ipa_platform_uat
```

#### 3. 部署應用

```bash
# 使用 staging 鏡像
kubectl apply -f k8s/uat/ -n ipa-uat

# 驗證部署
kubectl get pods -n ipa-uat
curl https://uat.ipa-platform.com/health
```

#### 4. 配置測試用戶

```bash
# 創建 UAT 測試用戶
curl -X POST https://uat.ipa-platform.com/api/v1/users \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "uat-user-1@example.com",
    "username": "uat_user_1",
    "full_name": "UAT User 1",
    "password": "UatTest2025!",
    "roles": ["user"]
  }'
```

### 環境檢查清單

| 項目 | 狀態 |
|------|------|
| UAT 環境可訪問 | ☐ |
| 數據庫已初始化 | ☐ |
| 測試用戶已創建 | ☐ |
| SSL 證書有效 | ☐ |
| 監控正常運作 | ☐ |
| 與生產環境隔離 | ☐ |

---

## 測試場景

### TC-001: 工作流創建和管理

**前置條件**: 用戶已登錄，具有 developer 角色

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 點擊「新增工作流」 | 顯示工作流創建頁面 |
| 2 | 輸入名稱「UAT 測試工作流」 | 名稱顯示在表單中 |
| 3 | 添加 Trigger 節點 | 節點出現在畫布上 |
| 4 | 添加 Agent 節點並連接 | 節點連線成功 |
| 5 | 配置 Agent 參數 | 參數保存成功 |
| 6 | 添加 End 節點並連接 | 工作流結構完整 |
| 7 | 點擊「保存草稿」 | 提示保存成功 |
| 8 | 點擊「發布」 | 工作流狀態變為 active |

**驗收標準**: 工作流成功創建並可在列表中查看

---

### TC-002: 工作流執行

**前置條件**: 已有 active 狀態的工作流

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 在工作流列表點擊「執行」 | 顯示執行確認對話框 |
| 2 | 輸入執行參數 (如有) | 參數欄位可填寫 |
| 3 | 點擊「確認執行」 | 執行開始，跳轉到執行詳情頁 |
| 4 | 觀察執行狀態 | 狀態從 pending → running |
| 5 | 查看步驟進度 | 各步驟狀態即時更新 |
| 6 | 查看執行日誌 | 日誌即時顯示 |
| 7 | 等待執行完成 | 狀態變為 completed |
| 8 | 檢查執行結果 | 顯示正確的輸出數據 |

**驗收標準**: 執行成功完成，日誌和結果正確顯示

---

### TC-003: 檢查點審批

**前置條件**: 工作流包含 Checkpoint 節點

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 執行包含 Checkpoint 的工作流 | 執行開始 |
| 2 | 工作流到達 Checkpoint | 執行暫停，狀態為 paused |
| 3 | 審批人收到通知 | Teams/Email 通知到達 |
| 4 | 審批人查看審批頁面 | 顯示審批詳情和選項 |
| 5 | 點擊「批准」 | 提示審批成功 |
| 6 | 查看執行狀態 | 執行繼續，狀態為 running |
| 7 | 等待完成 | 工作流成功完成 |

**驗收標準**: 審批流程正常工作，通知正確發送

---

### TC-004: 錯誤處理和重試

**前置條件**: 工作流配置了錯誤重試

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 執行會失敗的工作流 | 執行開始 |
| 2 | 觀察自動重試 | 系統自動重試（按配置次數）|
| 3 | 重試仍失敗 | 執行狀態變為 failed |
| 4 | 查看錯誤信息 | 顯示清晰的錯誤原因 |
| 5 | 點擊「重試」按鈕 | 執行重新開始 |
| 6 | 修正問題後執行 | 執行成功完成 |

**驗收標準**: 錯誤處理和重試機制正常工作

---

### TC-005: Agent 智能回應

**前置條件**: 已配置 Azure OpenAI

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 創建包含 Agent 節點的工作流 | 工作流創建成功 |
| 2 | 配置 Agent prompt | Prompt 保存成功 |
| 3 | 執行工作流 | 執行開始 |
| 4 | 觀察 Agent 處理 | Agent 正在處理 |
| 5 | 檢查 Agent 輸出 | 輸出相關且合理 |
| 6 | 驗證 token 使用 | Token 統計正確顯示 |

**驗收標準**: Agent 回應質量符合預期

---

### TC-006: 監控和告警

**前置條件**: 用戶具有 operator 或 admin 角色

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 訪問 Dashboard | 顯示系統概覽 |
| 2 | 查看執行統計 | 數據正確顯示 |
| 3 | 查看系統健康 | CPU/Memory 指標正常 |
| 4 | 訪問 Grafana | Dashboard 可訪問 |
| 5 | 配置告警規則 | 規則保存成功 |
| 6 | 觸發測試告警 | 告警通知發送成功 |

**驗收標準**: 監控數據準確，告警正常觸發

---

### TC-007: 用戶權限管理

**前置條件**: 登錄為 admin 用戶

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 創建新用戶 | 用戶創建成功 |
| 2 | 分配 viewer 角色 | 角色分配成功 |
| 3 | 用新用戶登錄 | 登錄成功 |
| 4 | 嘗試創建工作流 | 權限不足，操作被拒絕 |
| 5 | Admin 升級權限為 developer | 權限更新成功 |
| 6 | 新用戶重新登錄 | 可以創建工作流 |

**驗收標準**: RBAC 權限控制正確執行

---

### TC-008: 審計日誌

**前置條件**: 執行了多項操作

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 訪問審計日誌頁面 | 日誌列表顯示 |
| 2 | 按用戶篩選 | 顯示該用戶的操作 |
| 3 | 按操作類型篩選 | 顯示該類型的操作 |
| 4 | 按時間範圍篩選 | 顯示指定時間內的操作 |
| 5 | 導出日誌 (CSV) | 文件下載成功 |
| 6 | 驗證導出內容 | 數據完整正確 |

**驗收標準**: 所有操作都有審計記錄

---

### TC-009: n8n 集成

**前置條件**: n8n 已配置

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 創建 webhook 觸發工作流 | 工作流創建成功 |
| 2 | 從 n8n 發送 webhook | 收到 webhook 請求 |
| 3 | 驗證簽名驗證 | 簽名驗證通過 |
| 4 | 觀察工作流執行 | 工作流自動啟動 |
| 5 | 檢查執行數據 | 數據從 webhook 正確傳入 |

**驗收標準**: n8n webhook 集成正常工作

---

### TC-010: 性能基準

**前置條件**: 系統無額外負載

| 步驟 | 操作 | 預期結果 |
|------|------|----------|
| 1 | 測量登錄響應時間 | < 2 秒 |
| 2 | 測量工作流列表加載 | < 3 秒 |
| 3 | 測量執行啟動時間 | < 5 秒 |
| 4 | 測量 Dashboard 加載 | < 3 秒 |
| 5 | 同時執行 5 個工作流 | 均成功完成 |

**驗收標準**: 所有性能指標達標

---

## 用戶培訓

### 培訓計劃

| 時間 | 主題 | 內容 | 時長 |
|------|------|------|------|
| 09:00 | 系統概述 | 功能介紹、架構說明 | 30 分鐘 |
| 09:30 | 登錄和導航 | 登錄流程、Dashboard 使用 | 15 分鐘 |
| 09:45 | 工作流創建 | 節點、連線、配置 | 45 分鐘 |
| 10:30 | 休息 | - | 15 分鐘 |
| 10:45 | 工作流執行 | 觸發、監控、錯誤處理 | 30 分鐘 |
| 11:15 | 審批流程 | Checkpoint、審批操作 | 20 分鐘 |
| 11:35 | 監控和告警 | Dashboard、Grafana | 25 分鐘 |
| 12:00 | Q&A | 問答環節 | 30 分鐘 |

### 培訓材料

- 📄 用戶快速入門指南 (`docs/user-guide/getting-started.md`)
- 📄 工作流創建教程 (`docs/user-guide/creating-workflows.md`)
- 📄 執行工作流指南 (`docs/user-guide/executing-workflows.md`)
- 📄 監控與告警指南 (`docs/user-guide/monitoring.md`)
- 🎥 Demo 視頻 (可選)

### 培訓環境

- 培訓環境 URL: https://training.ipa-platform.com
- 測試帳號: `training-user-{1-10}@example.com`
- 預設密碼: `TrainingPass2025!`

---

## 測試執行

### 每日流程

```
09:00 - 09:15  早會（昨日進度、今日計劃）
09:15 - 12:00  測試執行
12:00 - 13:00  午餐
13:00 - 16:30  測試執行
16:30 - 17:00  日報（問題匯總、進度更新）
```

### 問題記錄模板

```yaml
問題編號: UAT-001
發現時間: 2025-MM-DD HH:MM
測試場景: TC-001 工作流創建
嚴重程度: P0/P1/P2/P3
狀態: 新建/進行中/已修復/已驗證

問題描述: |
  [簡要描述問題]

重現步驟:
  1. [步驟 1]
  2. [步驟 2]
  3. [步驟 3]

預期結果: |
  [預期應該發生什麼]

實際結果: |
  [實際發生了什麼]

截圖/日誌: |
  [附加相關截圖或日誌]

發現人: [姓名]
指派給: [開發人員姓名]
修復版本: [版本號]
驗證人: [姓名]
驗證日期: [日期]
```

### 問題嚴重程度定義

| 等級 | 定義 | 處理時限 |
|------|------|----------|
| P0 - Critical | 系統無法使用，阻塞測試 | 立即處理 |
| P1 - High | 主要功能受影響 | 24 小時內 |
| P2 - Medium | 次要功能問題 | UAT 期間 |
| P3 - Low | 輕微問題，不影響使用 | Phase 2 |

---

## 反饋收集

### 反饋表單

```markdown
## UAT 用戶反饋表

**測試日期**: _______________
**測試人員**: _______________
**角色**: ☐ 業務用戶  ☐ 管理員  ☐ 操作員

### 功能評分 (1-5, 5 為最佳)

| 功能 | 易用性 | 功能完整性 | 性能 | 備註 |
|------|--------|------------|------|------|
| 工作流創建 | _____ | _____ | _____ | _____ |
| 工作流執行 | _____ | _____ | _____ | _____ |
| 審批流程 | _____ | _____ | _____ | _____ |
| 監控 Dashboard | _____ | _____ | _____ | _____ |
| 用戶管理 | _____ | _____ | _____ | _____ |

### 整體評價

**最滿意的功能**:
_________________________________________________________________

**最需要改進的地方**:
_________________________________________________________________

**缺少的功能或建議**:
_________________________________________________________________

**是否推薦使用？**: ☐ 是  ☐ 否  ☐ 需要改進後再評估

**簽名**: _______________  **日期**: _______________
```

### 反饋彙總

```yaml
# UAT 反饋彙總報告
總測試場景: 10
通過場景: _____
失敗場景: _____
通過率: _____%

總問題數: _____
P0 問題: _____
P1 問題: _____
P2 問題: _____
P3 問題: _____

已修復: _____
待修復: _____

平均滿意度評分: _____/5

主要正面反饋:
  - [反饋 1]
  - [反饋 2]

主要改進建議:
  - [建議 1]
  - [建議 2]
```

---

## Sign-off 流程

### Sign-off 條件

| 條件 | 要求 | 當前狀態 |
|------|------|----------|
| 測試場景通過率 | ≥ 95% | ☐ |
| P0 問題 | 0 | ☐ |
| P1 問題 | 0 | ☐ |
| P2 問題 | 已記錄 (可延後) | ☐ |
| 性能達標 | P95 < 5s | ☐ |
| 用戶滿意度 | ≥ 4.0/5 | ☐ |
| 所有角色參與 | 業務用戶、管理員 | ☐ |
| 培訓完成 | 所有用戶 | ☐ |

### Sign-off 文檔

```markdown
# IPA Platform UAT Sign-off 文檔

## 項目資訊
- 項目名稱: IPA - Intelligent Process Automation Platform
- 版本: 1.0.0
- UAT 期間: [開始日期] 至 [結束日期]

## 測試結果摘要
- 測試場景總數: 10
- 通過: ___
- 失敗: ___
- 通過率: ___%

## 問題狀態
- P0/P1 問題: 全部已解決
- P2/P3 問題: 已記錄，計劃 Phase 2 處理

## Sign-off 聲明

茲確認 IPA Platform v1.0.0 已完成用戶驗收測試，
測試結果符合上線標準，同意進行生產環境部署。

**業務代表簽核**:
姓名: _______________
簽名: _______________
日期: _______________

**技術代表簽核**:
姓名: _______________
簽名: _______________
日期: _______________

**產品負責人簽核**:
姓名: _______________
簽名: _______________
日期: _______________
```

### Sign-off 後續步驟

1. ☐ 歸檔 UAT 文檔
2. ☐ 記錄已知問題清單
3. ☐ 確定生產部署日期
4. ☐ 準備 Go-Live 通知
5. ☐ 安排上線支援人員

---

## 附錄

### A. 測試數據

```yaml
# 測試用工作流配置
test_workflow:
  name: "UAT Test Workflow"
  trigger_type: "manual"
  steps:
    - type: "trigger"
      config:
        input_schema:
          type: "object"
          properties:
            message:
              type: "string"
    - type: "agent"
      config:
        model: "gpt-4o-mini"
        prompt: "Analyze: {{input.message}}"
    - type: "end"
      config:
        output: "{{agent.response}}"
```

### B. 聯繫人

| 角色 | 姓名 | Email |
|------|------|-------|
| UAT 協調員 | - | uat-coordinator@example.com |
| 技術支援 | - | tech-support@example.com |
| 問題報告 | - | issues@example.com |

---

*最後更新: 2025-11-27*
