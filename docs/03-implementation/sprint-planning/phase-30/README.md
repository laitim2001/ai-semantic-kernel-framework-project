# Phase 30: Azure AI Search æ•´åˆ SemanticRouter

## æ¦‚è¿°

Phase 30 å°ˆæ³¨æ–¼å°‡ **SemanticRouter** å¾å…§å­˜å¯¦ç¾é·ç§»åˆ° **Azure AI Search**ï¼Œå¯¦ç¾æŒä¹…åŒ–å‘é‡å­˜å„²ã€å‹•æ…‹è·¯ç”±ç®¡ç†å’Œä¼æ¥­ç´šæœç´¢èƒ½åŠ›ã€‚

æœ¬ Phase æ˜¯ Phase 28 ä¸‰å±¤è·¯ç”±ç³»çµ±çš„å»¶ä¼¸å¢å¼·ï¼Œå°‡ Layer 2 (SemanticRouter) å‡ç´šç‚ºé›²ç«¯å‘é‡æ•¸æ“šåº«æ”¯æŒã€‚

## ç›®æ¨™

1. **Azure AI Search ç´¢å¼•** - å»ºç«‹èªç¾©è·¯ç”±å‘é‡ç´¢å¼•
2. **AzureSemanticRouter** - å¯¦ç¾åŸºæ–¼ Azure AI Search çš„èªç¾©è·¯ç”±å™¨
3. **è·¯ç”±ç®¡ç† API** - å‹•æ…‹æ–°å¢/ä¿®æ”¹/åˆªé™¤èªç¾©è·¯ç”±
4. **è³‡æ–™é·ç§»** - å°‡ç¾æœ‰ 15 æ¢è·¯ç”±é·ç§»åˆ° Azure
5. **ç›£æ§æ•´åˆ** - å»ºç«‹æœç´¢æ€§èƒ½ç›£æ§

## å‰ç½®æ¢ä»¶

- âœ… Phase 28 å®Œæˆ (ä¸‰å±¤æ„åœ–è·¯ç”±ç³»çµ±)
- âœ… Phase 29 å®Œæˆ (Agent Swarm å¯è¦–åŒ–)
- âœ… Azure OpenAI å·²é…ç½® (Embedding æ¨¡å‹)
- âœ… Azure è¨‚é–±å¯ç”¨
- â¬œ Azure AI Search è³‡æºå»ºç«‹

## Sprint è¦åŠƒ

| Sprint | åç¨± | Story Points | ç‹€æ…‹ |
|--------|------|--------------|------|
| [Sprint 107](./sprint-107-plan.md) | Azure AI Search è³‡æºå»ºç«‹ + ç´¢å¼•è¨­è¨ˆ | 15 é» | ğŸ“‹ è¨ˆåŠƒä¸­ |
| [Sprint 108](./sprint-108-plan.md) | AzureSemanticRouter å¯¦ç¾ | 25 é» | ğŸ“‹ è¨ˆåŠƒä¸­ |
| [Sprint 109](./sprint-109-plan.md) | è·¯ç”±ç®¡ç† API + è³‡æ–™é·ç§» | 20 é» | ğŸ“‹ è¨ˆåŠƒä¸­ |
| [Sprint 110](./sprint-110-plan.md) | æ•´åˆæ¸¬è©¦ + ç›£æ§ + æ–‡æª” | 15 é» | ğŸ“‹ è¨ˆåŠƒä¸­ |

**ç¸½è¨ˆ**: 75 Story Points (4 Sprints)
**é ä¼°æ™‚ç¨‹**: 3 é€± + 0.5 é€±ç·©è¡ = 3.5 é€±

## æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 30: Azure AI Search æ•´åˆæ¶æ§‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      BusinessIntentRouter (Phase 28)                         â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚   Layer 1: PatternMatcher (ä¸è®Š)                                            â”‚    â”‚
â”‚  â”‚     â””â”€ rules.yaml - 34 æ¢è¦å‰‡                                               â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚   Layer 2: AzureSemanticRouter (ğŸ†• å‡ç´š)                                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ Azure AI Search å‘é‡æœç´¢                                             â”‚    â”‚
â”‚  â”‚     â”œâ”€ Azure OpenAI Embedding                                               â”‚    â”‚
â”‚  â”‚     â””â”€ å‹•æ…‹è·¯ç”±ç®¡ç†                                                         â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚   Layer 3: LLMClassifier (ä¸è®Š)                                             â”‚    â”‚
â”‚  â”‚     â””â”€ Claude Haiku                                                          â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                          â”‚                                           â”‚
â”‚                                          â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                           Azure Cloud                                        â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚   â”‚     Azure AI Search      â”‚    â”‚     Azure OpenAI         â”‚             â”‚    â”‚
â”‚  â”‚   â”‚                          â”‚    â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚   â”‚  Index: semantic-routes  â”‚    â”‚  text-embedding-ada-002  â”‚             â”‚    â”‚
â”‚  â”‚   â”‚  â€¢ 56 utterances        â”‚â—„â”€â”€â”€â”‚  (Embedding ç”Ÿæˆ)         â”‚             â”‚    â”‚
â”‚  â”‚   â”‚  â€¢ HNSW å‘é‡ç´¢å¼•         â”‚    â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚   â”‚  â€¢ æ··åˆæœç´¢æ”¯æŒ          â”‚    â”‚  gpt-4o                  â”‚             â”‚    â”‚
â”‚  â”‚   â”‚                          â”‚    â”‚  (LLM åˆ†é¡)              â”‚             â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Route Management API (ğŸ†• æ–°å¢)                           â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚   POST   /api/v1/orchestration/routes          # æ–°å¢è·¯ç”±                   â”‚    â”‚
â”‚  â”‚   GET    /api/v1/orchestration/routes          # åˆ—å‡ºè·¯ç”±                   â”‚    â”‚
â”‚  â”‚   PUT    /api/v1/orchestration/routes/{id}     # æ›´æ–°è·¯ç”±                   â”‚    â”‚
â”‚  â”‚   DELETE /api/v1/orchestration/routes/{id}     # åˆªé™¤è·¯ç”±                   â”‚    â”‚
â”‚  â”‚   POST   /api/v1/orchestration/routes/sync     # YAML â†’ Azure åŒæ­¥         â”‚    â”‚
â”‚  â”‚   POST   /api/v1/orchestration/routes/search   # æ¸¬è©¦æœç´¢                   â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç’°å¢ƒé…ç½®

### æ–°å¢ç’°å¢ƒè®Šé‡

```bash
# Azure AI Search
AZURE_SEARCH_ENDPOINT=https://<search-service>.search.windows.net
AZURE_SEARCH_API_KEY=<your-api-key>
AZURE_SEARCH_INDEX_NAME=semantic-routes

# è·¯ç”±é…ç½®
USE_AZURE_SEARCH=true
SEMANTIC_SIMILARITY_THRESHOLD=0.85
SEMANTIC_TOP_K=3
```

### Azure è³‡æºéœ€æ±‚

| è³‡æº | SKU | ä¼°è¨ˆæˆæœ¬ (USD/æœˆ) |
|------|-----|-------------------|
| Azure AI Search | Basic | ~$75 |
| Azure OpenAI (Embeddings) | æŒ‰é‡è¨ˆè²» | ~$10-20 |

## æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| azure-search-documents | 11.4+ | Azure AI Search SDK |
| azure-identity | 1.14+ | Azure èº«ä»½é©—è­‰ |
| openai | 1.10+ | Azure OpenAI Embedding |
| Python | 3.11+ | å¾Œç«¯å¯¦ç¾ |

## é¢¨éšªèˆ‡ç·©è§£

| é¢¨éšª | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|----------|
| Azure Search å»¶é² | æœç´¢è®Šæ…¢ | è¨­å®š timeoutã€fallback åˆ° LLM |
| Embedding æˆæœ¬ | è²»ç”¨å¢åŠ  | å¿«å–å¸¸ç”¨æŸ¥è©¢ã€æ‰¹æ¬¡è™•ç† |
| ç´¢å¼•åŒæ­¥å•é¡Œ | è³‡æ–™ä¸ä¸€è‡´ | å®šæœŸé©—è­‰ã€ç‰ˆæœ¬æ§åˆ¶ |
| ç¶²è·¯é€£æ¥å¤±æ•— | æœå‹™ä¸­æ–· | é‡è©¦æ©Ÿåˆ¶ã€æœ¬åœ°å¿«å– |

## æˆåŠŸæ¨™æº–

- [ ] Azure AI Search è³‡æºæˆåŠŸå»ºç«‹
- [ ] ç´¢å¼•çµæ§‹ç¬¦åˆè¨­è¨ˆ
- [ ] 15 æ¢è·¯ç”±æˆåŠŸé·ç§»
- [ ] æœç´¢å»¶é² < 100ms (P95)
- [ ] è·¯ç”±ç®¡ç† API å…¨éƒ¨é€šéæ¸¬è©¦
- [ ] èˆ‡ BusinessIntentRouter æ•´åˆæˆåŠŸ
- [ ] ç›£æ§ dashboard å¯ç”¨
- [ ] æ–‡æª”å®Œæ•´

## å›æ»¾è¨ˆåŠƒ

```bash
# åˆ‡æ›å›å…§å­˜è·¯ç”±å™¨
USE_AZURE_SEARCH=false
```

ç³»çµ±æœƒè‡ªå‹• fallback åˆ°åŸæœ‰çš„ SemanticRouter å¯¦ç¾ã€‚

---

**Phase 30 é–‹å§‹æ™‚é–“**: TBD
**é ä¼°å®Œæˆæ™‚é–“**: 3.5 é€± (3 é€± + 0.5 é€±ç·©è¡)
**ç¸½ Story Points**: 75 pts
