# Phase 22: Claude è‡ªä¸»èƒ½åŠ›èˆ‡å­¸ç¿’ç³»çµ±

## Overview

Phase 22 å°ˆæ³¨æ–¼è®“ Claude å¾ã€ŒTool åŸ·è¡Œè€…ã€å‡ç´šç‚ºã€Œè‡ªä¸»è¦åŠƒè€…ã€ï¼Œä¸¦æ•´åˆ mem0 é•·æœŸè¨˜æ†¶ç³»çµ±ï¼Œå¯¦ç¾ AI åŠ©æ‰‹çš„å­¸ç¿’å’Œè¨˜æ†¶èƒ½åŠ›ã€‚

## Phase Status

| Status | Value |
|--------|-------|
| **Phase Status** | è¨ˆåŠƒä¸­ |
| **Duration** | 2 sprints |
| **Total Story Points** | 50 pts |
| **Priority** | ğŸ”´ P0 é«˜å„ªå…ˆ |
| **Target Start** | Phase 21 å®Œæˆå¾Œ |

## Sprint Overview

| Sprint | Focus | Story Points | Status | Documents |
|--------|-------|--------------|--------|-----------|
| **Sprint 79** | Claude è‡ªä¸»è¦åŠƒå¼•æ“ + mem0 æ•´åˆ | 23 pts | è¨ˆåŠƒä¸­ | [Plan](sprint-79-plan.md) / [Checklist](sprint-79-checklist.md) |
| **Sprint 80** | å­¸ç¿’ç³»çµ±èˆ‡æ™ºèƒ½å›é€€ | 27 pts | è¨ˆåŠƒä¸­ | [Plan](sprint-80-plan.md) / [Checklist](sprint-80-checklist.md) |
| **Total** | | **50 pts** | | |

---

## å•é¡ŒèƒŒæ™¯

### ç¾ç‹€

1. **Claude è§’è‰²å®šä½åå·®**
   - ç›®å‰ Claude åƒ…ä½œç‚ºã€ŒTool åŸ·è¡Œè€…ã€
   - æ¥æ”¶æŒ‡ä»¤ â†’ èª¿ç”¨å·¥å…· â†’ è¿”å›çµæœ
   - ç¼ºå°‘ä¸»å‹•è¦åŠƒå’Œè‡ªä¸»æ±ºç­–èƒ½åŠ›

2. **å­¸ç¿’å’Œè¨˜æ†¶ç³»çµ±ç¼ºå¤±**
   - ç„¡æ³•å¾æ­·å²äº‹ä»¶å­¸ç¿’æœ€ä½³å¯¦è¸
   - æ¯æ¬¡æœƒè©±éƒ½æ˜¯ã€Œå…¨æ–°é–‹å§‹ã€
   - ç„¡æ³•è¨˜ä½ç”¨æˆ¶åå¥½å’Œç³»çµ±çŸ¥è­˜

3. **ç¼ºå°‘è‡ªä¸»è¦åŠƒé–‰ç’°**
   - æ²’æœ‰ã€Œåˆ†æ â†’ è¦åŠƒ â†’ åŸ·è¡Œ â†’ é©—è­‰ã€å®Œæ•´æµç¨‹
   - Extended Thinking åŠŸèƒ½æœªå……åˆ†åˆ©ç”¨
   - æ±ºç­–éç¨‹ä¸é€æ˜

### ç›®æ¨™

- Claude èƒ½è‡ªä¸»è¦åŠƒè¤‡é›œ IT äº‹ä»¶è™•ç†æ­¥é©Ÿ
- é€šé mem0 å¯¦ç¾è·¨æœƒè©±å­¸ç¿’å’Œè¨˜æ†¶
- å»ºç«‹å¯è§£é‡‹çš„æ±ºç­–å¯©è¨ˆè¿½è¹¤

---

## Architecture

### Claude è‡ªä¸»è¦åŠƒå¼•æ“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Claude è‡ªä¸»è¦åŠƒå¼•æ“æ¶æ§‹                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  è¼¸å…¥å±¤                                                                              â”‚
â”‚  â•â•â•â•â•â•â•                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ IT äº‹ä»¶     â”‚    â”‚ ç”¨æˆ¶è«‹æ±‚    â”‚    â”‚ ç³»çµ±å‘Šè­¦    â”‚                             â”‚
â”‚  â”‚ (ServiceNow)â”‚    â”‚ (Chat)      â”‚    â”‚ (Prometheus)â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚         â”‚                  â”‚                  â”‚                                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                            â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Claude è‡ªä¸»è¦åŠƒå¼•æ“                                    â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚   Phase 1: åˆ†æ â†’ Extended Thinking (å‹•æ…‹ budget_tokens)                    â”‚   â”‚
â”‚  â”‚   Phase 2: è¦åŠƒ â†’ è‡ªä¸»æ±ºç­–æ¨¹ç”Ÿæˆ                                             â”‚   â”‚
â”‚  â”‚   Phase 3: åŸ·è¡Œ â†’ èª¿ç”¨ MAF Workflow / Claude Tools                          â”‚   â”‚
â”‚  â”‚   Phase 4: é©—è­‰ â†’ çµæœé©—è­‰å’Œå­¸ç¿’                                             â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### mem0 ä¸‰å±¤è¨˜æ†¶æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            mem0 ä¸‰å±¤è¨˜æ†¶æ¶æ§‹                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  Layer 1: å·¥ä½œè¨˜æ†¶ (Redis)                          â† å·²å¯¦ç¾ âœ…                      â”‚
â”‚  Layer 2: æœƒè©±è¨˜æ†¶ (PostgreSQL)                     â† å·²å¯¦ç¾ âœ…                      â”‚
â”‚  Layer 3: é•·æœŸè¨˜æ†¶ (mem0)                           â† Phase 22 å¯¦ç¾ ğŸ†•              â”‚
â”‚                                                                                      â”‚
â”‚  çµ±ä¸€è¨˜æ†¶ç®¡ç†å™¨:                                                                     â”‚
â”‚  - working_memory: RedisCache           # ç†±æ•¸æ“š                                    â”‚
â”‚  - session_memory: PostgresCheckpoint   # æº«æ•¸æ“š                                    â”‚
â”‚  - long_term_memory: Mem0Client         # å†·æ•¸æ“š                                    â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Features

### Sprint 79: Claude è‡ªä¸»è¦åŠƒå¼•æ“ + mem0 æ•´åˆ (23 pts)

| Story | Description | Points | Priority |
|-------|-------------|--------|----------|
| S79-1 | Claude è‡ªä¸»è¦åŠƒå¼•æ“ | 13 pts | P0 |
| S79-2 | mem0 é•·æœŸè¨˜æ†¶æ•´åˆ | 10 pts | P0 |

### Sprint 80: å­¸ç¿’ç³»çµ±èˆ‡æ™ºèƒ½å›é€€ (27 pts)

| Story | Description | Points | Priority |
|-------|-------------|--------|----------|
| S80-1 | Few-shot å­¸ç¿’ç³»çµ± | 8 pts | P1 |
| S80-2 | è‡ªä¸»æ±ºç­–å¯©è¨ˆè¿½è¹¤ | 8 pts | P1 |
| S80-3 | Trial-and-Error æ™ºèƒ½å›é€€ | 6 pts | P1 |
| S80-4 | Claude Session ç‹€æ…‹å¢å¼· | 5 pts | P2 |

---

## Technical Details

### Extended Thinking é…ç½®

```python
# å‹•æ…‹ budget_tokens èª¿æ•´ç­–ç•¥
async def calculate_budget_tokens(event_complexity: str) -> int:
    complexity_map = {
        "simple": 4096,      # ç°¡å–®äº‹ä»¶
        "moderate": 8192,    # ä¸­ç­‰è¤‡é›œ
        "complex": 16000,    # è¤‡é›œäº‹ä»¶
        "critical": 32000,   # é—œéµäº‹ä»¶
    }
    return complexity_map.get(event_complexity, 8192)
```

### mem0 SDK æ•´åˆ

```python
from mem0 import Memory

# åˆå§‹åŒ– mem0 (ä½¿ç”¨æœ¬åœ° Qdrant)
memory = Memory(
    vector_store={
        "provider": "qdrant",
        "config": {"path": "/data/mem0/qdrant"}
    },
    embedder={
        "provider": "openai",
        "config": {"model": "text-embedding-3-small"}
    }
)
```

### API Endpoints

```
# Claude è‡ªä¸»è¦åŠƒ
POST   /api/v1/claude/autonomous/plan     # ç”Ÿæˆè‡ªä¸»è¦åŠƒ
GET    /api/v1/claude/autonomous/{id}     # ç²å–è¦åŠƒç‹€æ…‹
POST   /api/v1/claude/autonomous/{id}/execute  # åŸ·è¡Œè¦åŠƒ

# mem0 è¨˜æ†¶ç®¡ç†
POST   /api/v1/memory/add                 # æ·»åŠ è¨˜æ†¶
GET    /api/v1/memory/search              # æœç´¢è¨˜æ†¶
GET    /api/v1/memory/user/{user_id}      # ç²å–ç”¨æˆ¶è¨˜æ†¶
DELETE /api/v1/memory/{id}                # åˆªé™¤è¨˜æ†¶

# å¯©è¨ˆè¿½è¹¤
GET    /api/v1/audit/decisions            # ç²å–æ±ºç­–è¨˜éŒ„
GET    /api/v1/audit/decisions/{id}       # ç²å–æ±ºç­–è©³æƒ…
```

---

## Dependencies

### Prerequisites
- Phase 21 completed (æ²™ç®±å®‰å…¨æ¶æ§‹)
- Phase 12 completed (Claude SDK Integration)
- Redis + PostgreSQL infrastructure

### New Dependencies

**Backend**:
```bash
pip install mem0ai>=1.0.1
pip install qdrant-client>=1.7.0
pip install openai>=1.0.0  # ç”¨æ–¼åµŒå…¥æ¨¡å‹
```

---

## Risks & Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| mem0 æˆæœ¬è¶…é ç®— | High | Medium | ä½¿ç”¨æœ¬åœ° Qdrant æ›¿ä»£é›²æœå‹™ |
| Extended Thinking å“è³ªä¸ç©©å®š | High | Low | å‹•æ…‹èª¿æ•´ budget_tokens |
| å‘é‡åµŒå…¥ API é™åˆ¶ | Medium | Medium | æ‰¹é‡è™•ç† + ç·©å­˜ |

---

## Verification

### Sprint 79 é©—è­‰
- [ ] Claude èƒ½æ¥æ”¶ IT äº‹ä»¶ä¸¦è‡ªä¸»ç”Ÿæˆè™•ç†è¦åŠƒ
- [ ] Extended Thinking è¼¸å‡ºåŒ…å«åˆ†æå’Œè¦åŠƒæ­¥é©Ÿ
- [ ] mem0 SDK æˆåŠŸåˆå§‹åŒ–å’Œé€£æ¥
- [ ] èƒ½å­˜å„²å’Œæª¢ç´¢è¨˜æ†¶

### Sprint 80 é©—è­‰
- [ ] Few-shot å­¸ç¿’èƒ½å¾æ­·å²æ¡ˆä¾‹æå–ç¯„ä¾‹
- [ ] æ±ºç­–å¯©è¨ˆè¨˜éŒ„å®Œæ•´ä¸”å¯æŸ¥è©¢
- [ ] Trial-and-Error æ©Ÿåˆ¶åœ¨å¤±æ•—æ™‚è‡ªå‹•å›é€€
- [ ] Session ç‹€æ…‹èƒ½è·¨æœƒè©±ä¿æŒ

---

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Claude è‡ªä¸»è¦åŠƒæˆåŠŸç‡ | > 80% | æˆåŠŸç”Ÿæˆå¯åŸ·è¡Œè¦åŠƒçš„æ¯”ä¾‹ |
| mem0 è¨˜æ†¶æª¢ç´¢æº–ç¢ºç‡ | > 80% | Top-5 çµæœä¸­åŒ…å«ç›¸é—œè¨˜æ†¶çš„æ¯”ä¾‹ |
| Extended Thinking å“è³ªè©•åˆ† | > 4/5 | äººå·¥è©•ä¼°åˆ†æå’Œè¦åŠƒçš„å“è³ª |

---

**Created**: 2026-01-12
**Total Story Points**: 50 pts
