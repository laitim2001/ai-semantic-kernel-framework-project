# Sprint 11: Nested Workflows - Decisions Log

## 決策記錄

### D11-001: 嵌套工作流類型設計
**日期**: 2025-12-05
**決策**: 支援 4 種嵌套類型 (INLINE, REFERENCE, DYNAMIC, RECURSIVE)
**原因**: 涵蓋所有常見的工作流嵌套場景
**影響**: 需要為每種類型實現不同的執行邏輯

### D11-002: 上下文作用域設計
**日期**: 2025-12-05
**決策**: 支援 3 種作用域 (ISOLATED, INHERITED, SHARED)
**原因**: 提供靈活的變數傳遞控制
**影響**: 需要實現複雜的上下文管理邏輯

### D11-003: 循環依賴檢測算法
**日期**: 2025-12-05
**決策**: 使用 DFS 深度優先搜索進行循環檢測
**原因**: 效率高且易於實現
**影響**: 在註冊子工作流時進行檢測

### D11-004: 子工作流執行模式
**日期**: 2025-12-05
**決策**: 支援 4 種執行模式 (SYNC, ASYNC, FIRE_AND_FORGET, CALLBACK)
**原因**: 滿足不同的執行需求場景
- SYNC: 需要立即獲取結果的場景
- ASYNC: 需要追蹤但不阻塞的場景
- FIRE_AND_FORGET: 不需要關心結果的場景
- CALLBACK: 需要回調通知的場景
**影響**: 需要實現多種執行策略和狀態追蹤

### D11-005: 遞歸策略選擇
**日期**: 2025-12-05
**決策**: 支援 3 種遞歸策略 (DEPTH_FIRST, BREADTH_FIRST, PARALLEL)
**原因**: 不同的問題適合不同的遍歷策略
- DEPTH_FIRST: 適合深度優先的問題
- BREADTH_FIRST: 適合層級遍歷
- PARALLEL: 適合可並行的分治問題
**影響**: 需要實現不同的遞歸執行引擎

### D11-006: 終止條件類型
**日期**: 2025-12-05
**決策**: 支援 6 種終止條件類型
- CONDITION: 條件表達式終止
- MAX_DEPTH: 最大深度限制
- MAX_ITERATIONS: 最大迭代次數
- TIMEOUT: 超時終止
- CONVERGENCE: 收斂檢測
- USER_ABORT: 用戶主動終止
**原因**: 提供多種控制遞歸結束的方式
**影響**: 需要實現複雜的終止檢測邏輯

### D11-007: 記憶化策略
**日期**: 2025-12-05
**決策**: 使用基於輸入哈希的記憶化緩存
**原因**: 避免重複計算相同輸入
**影響**:
- 需要實現輸入序列化和哈希計算
- 需要管理緩存的生命週期

### D11-008: 工作流組合構建器設計
**日期**: 2025-12-05
**決策**: 使用 Fluent API 設計模式
**原因**:
- 提供直觀的鏈式調用
- 易於理解和使用
- 支援嵌套組合
**影響**: 需要維護構建狀態棧

### D11-009: 組合模板設計
**日期**: 2025-12-05
**決策**: 提供 4 種預設模板 (map_reduce, pipeline, scatter_gather, saga)
**原因**: 這些是最常見的工作流組合模式
**影響**: 需要為每種模板實現專門的構建邏輯

### D11-010: 上下文傳播策略
**日期**: 2025-12-05
**決策**: 支援 4 種傳播類型 (COPY, REFERENCE, MERGE, FILTER)
**原因**:
- COPY: 完全隔離，安全性高
- REFERENCE: 性能最好，但需小心使用
- MERGE: 靈活合併
- FILTER: 精確控制傳播內容
**影響**: 需要實現不同的傳播策略

### D11-011: 數據流追蹤設計
**日期**: 2025-12-05
**決策**: 實現 DataFlowTracker 記錄所有數據流動
**原因**:
- 支援調試和審計
- 可視化數據依賴
**影響**: 需要在每次傳播時記錄事件

---

## 已解決事項

- [x] 支援跨工作流的變數引用 - 通過 SHARED 作用域實現
- [x] 遞歸深度限制的默認值設定 - 默認為 10 層

## 待決策事項

- [ ] 是否需要支援分布式遞歸執行
- [ ] 是否需要實現更多組合模板

