# Sprint 41 Technical Decisions: Additional MCP Servers

## 決策記錄

| ID | 決策 | 日期 | 狀態 |
|----|------|------|------|
| D41-1 | Shell 執行採用安全沙箱模式 | 2025-12-22 | ✅ 已採納 |
| D41-2 | Filesystem 使用路徑限制沙箱 | 2025-12-22 | ✅ 已採納 |
| D41-3 | SSH 採用連接池管理 | 2025-12-22 | ✅ 已採納 |
| D41-4 | LDAP 預設唯讀模式 | 2025-12-22 | ✅ 已採納 |
| D41-5 | 使用可選依賴模式 | 2025-12-22 | ✅ 已採納 |

---

## 決策詳情

### D41-1: Shell 執行採用安全沙箱模式

**背景**: Shell 命令執行具有高風險，需要安全控制

**選項**:
1. 無限制執行
2. 命令白名單模式
3. 命令黑名單 + 危險模式檢測

**決策**: 採用黑名單 + 危險模式檢測

**理由**:
- 阻擋已知危險命令 (rm -rf, fork bombs)
- 阻擋危險模式 (wget|sh, curl|bash)
- 執行超時保護
- 輸出大小限制
- 可配置白名單/黑名單

---

### D41-2: Filesystem 使用路徑限制沙箱

**背景**: 需要控制文件系統存取範圍

**選項**:
1. 無限制存取
2. 路徑白名單
3. 沙箱根目錄限制

**決策**: 實現 FilesystemSandbox 沙箱

**理由**:
- 限制在指定根目錄內操作
- 阻擋敏感文件模式 (.env, *.pem, *.key)
- 可配置讀/寫/刪除權限
- 文件大小限制保護

---

### D41-3: SSH 採用連接池管理

**背景**: 需要高效管理 SSH 連接

**選項**:
1. 每次請求新建連接
2. 全局單一連接
3. 連接池管理

**決策**: 實現 SSHConnectionManager 連接池

**理由**:
- 減少連接建立開銷
- 支援多主機並發連接
- 自動連接清理
- 連接複用提高效率

---

### D41-4: LDAP 預設唯讀模式

**背景**: LDAP 目錄修改具有高風險

**選項**:
1. 完全讀寫
2. 預設唯讀，可配置寫入
3. 僅唯讀

**決策**: 預設唯讀模式

**理由**:
- 保護目錄資料安全
- 減少誤操作風險
- 可通過配置開啟寫入
- 符合最小權限原則

---

### D41-5: 使用可選依賴模式

**背景**: SSH 需要 paramiko，LDAP 需要 ldap3

**選項**:
1. 強制安裝所有依賴
2. 可選依賴，未安裝時優雅降級
3. 分離成獨立套件

**決策**: 可選依賴模式

**理由**:
- 減少核心套件大小
- 按需安裝特定功能
- 未安裝時提供清晰錯誤訊息
- 不影響其他 MCP Server

---

**創建日期**: 2025-12-22
**更新日期**: 2025-12-22
