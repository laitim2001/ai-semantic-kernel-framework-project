# 🐛 情況3: Bug 修復 - 處理錯誤和問題

> **使用時機**: 發現 Bug 或錯誤需要修復時
> **目標**: 系統性地定位、分析和修復問題
> **適用場景**: 生產問題、測試失敗、用戶反饋的錯誤

---

## 📋 Prompt 模板 (給開發人員)

```markdown
你好！我需要修復一個 Bug。

**問題描述**: [簡要描述問題現象]

**重現步驟**:
1. [步驟 1]
2. [步驟 2]
3. [出現問題]

**預期行為**: [應該發生什麼]
**實際行為**: [實際發生什麼]

**錯誤訊息** (如有):
```
[貼上錯誤訊息]
```

請幫我：

1. 分析問題根源
   - 定位問題發生的代碼位置
   - 分析可能的原因

2. 提出修復方案
   - 給出具體的修復步驟
   - 評估修復的影響範圍

3. 實施修復
   - 修改相關代碼
   - 添加必要的測試

4. 驗證修復
   - 確認問題已解決
   - 確保沒有引入新問題

請用中文回答。
```

---

## 🤖 AI 助手執行步驟

### Step 1: 問題定位 (2 分鐘)

```bash
# 1. 根據錯誤訊息搜尋相關代碼
Grep: "錯誤關鍵字" backend/src/

# 2. 定位問題文件
Read: 相關文件的錯誤行附近代碼

# 3. 檢查相關日誌
Bash: docker-compose logs backend --tail=100 (如適用)
```

### Step 2: 根因分析 (3 分鐘)

```markdown
# 🔍 問題分析報告

## 問題摘要
- **現象**: [問題描述]
- **位置**: [file:line]
- **影響**: [影響範圍]

## 根因分析
1. **直接原因**: [代碼層面的問題]
2. **深層原因**: [設計或邏輯問題]

## 相關代碼
```python
# 問題代碼
[相關代碼片段]
```

## 修復方案
- **方案 A**: [描述] - 優點/缺點
- **方案 B**: [描述] - 優點/缺點 (如適用)
```

### Step 3: 實施修復 (5 分鐘)

```bash
# 1. 創建修復分支
Bash: git checkout -b fix/問題簡述

# 2. 修改代碼
Edit: 修復問題代碼

# 3. 添加測試
Write: tests/unit/test_xxx.py (針對這個 bug 的測試)

# 4. 運行測試
Bash: cd backend && pytest tests/unit/test_xxx.py -v
```

### Step 4: 驗證修復 (2 分鐘)

```bash
# 1. 運行相關測試
Bash: cd backend && pytest tests/unit/{相關模組}/ -v

# 2. 運行完整測試套件 (如時間允許)
Bash: cd backend && pytest tests/unit/ -v --tb=short

# 3. 手動驗證 (如適用)
Bash: curl http://localhost:8000/api/v1/...
```

---

## ✅ 驗收標準

AI 助手應該完成以下工作：

1. **問題定位**
   - 找到問題發生的具體代碼位置
   - 理解問題的重現條件

2. **根因分析**
   - 識別問題的根本原因
   - 評估問題的影響範圍

3. **修復實施**
   - 代碼修復完成
   - 添加了防止回歸的測試

4. **驗證完成**
   - 相關測試通過
   - 問題不再重現

5. **文檔更新** (如需要)
   - 更新相關文檔
   - 記錄修復細節

---

## 🔗 相關文檔

### 開發流程指引
- [情況1: 專案入門](./SITUATION-1-PROJECT-ONBOARDING.md)
- [情況5: 測試執行](./SITUATION-5-TESTING.md)
- [情況6: 保存進度](./SITUATION-6-SAVE-PROGRESS.md)

### 除錯資源
- `backend/CLAUDE.md` - 後端除錯指南
- `docs/api/` - API 文檔參考

---

**維護者**: AI 助手 + 開發團隊
**最後更新**: 2025-12-24
**版本**: 2.0
