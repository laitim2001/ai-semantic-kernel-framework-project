# 👀 情況8: 代碼審查 - 審查代碼變更

> **使用時機**: 需要審查 PR 或代碼變更時
> **目標**: 確保代碼品質和一致性
> **適用場景**: PR 審查、自我審查、代碼品質檢查

---

## 📋 Prompt 模板 (給開發人員)

```markdown
你好！我需要進行代碼審查。

**審查範圍**:
- [要審查的文件/PR]

**審查重點** (選填):
- [重點 1: 例如 安全性]
- [重點 2: 例如 性能]

請幫我：

1. 審查代碼變更
   - 檢查代碼品質
   - 檢查安全性問題
   - 檢查性能問題

2. 驗證測試覆蓋
   - 檢查測試是否足夠
   - 識別缺少的測試案例

3. 檢查規範遵循
   - 確認代碼風格
   - 確認架構模式

4. 提供審查意見
   - 列出問題和建議
   - 給出改進建議

請用中文回答。
```

---

## 🤖 AI 助手執行步驟

### Step 1: 識別變更範圍 (1 分鐘)

```bash
# 1. 查看變更的文件
Bash: git diff --name-only HEAD~1  # 最近一次提交
# 或
Bash: git diff --name-only main    # 與 main 分支比較

# 2. 查看變更統計
Bash: git diff --stat HEAD~1

# 3. 查看詳細變更
Bash: git diff HEAD~1
```

### Step 2: 閱讀代碼變更 (3 分鐘)

```bash
# 1. 閱讀變更的文件
Read: [變更的文件列表]

# 2. 了解變更的上下文
Read: 相關的測試文件
Read: 相關的 CLAUDE.md 文檔

# 3. 檢查相關模組
Grep: "import" 查找依賴關係
```

### Step 3: 執行代碼審查 (5 分鐘)

```markdown
# 👀 代碼審查報告

## 審查摘要
- **審查範圍**: [文件列表]
- **變更規模**: +X/-Y 行
- **審查結論**: ✅ 通過 / ⚠️ 需修改 / ❌ 需重做

## 詳細審查

### 1. 代碼品質
| 文件 | 問題 | 嚴重程度 | 建議 |
|------|------|----------|------|
| file.py:42 | [問題描述] | 🔴 高 | [建議] |
| file.py:67 | [問題描述] | 🟡 中 | [建議] |
| file.py:89 | [問題描述] | 🟢 低 | [建議] |

### 2. 安全性檢查
- [ ] 輸入驗證: ✅/❌
- [ ] SQL 注入防護: ✅/❌
- [ ] 認證/授權: ✅/❌
- [ ] 敏感資料處理: ✅/❌

### 3. 性能考量
- [ ] 無 N+1 查詢問題: ✅/❌
- [ ] 適當的快取使用: ✅/❌
- [ ] 無明顯性能瓶頸: ✅/❌

### 4. 測試覆蓋
- [ ] 新功能有對應測試: ✅/❌
- [ ] 邊界條件有測試: ✅/❌
- [ ] 錯誤處理有測試: ✅/❌

### 5. 規範遵循
- [ ] 命名規範: ✅/❌
- [ ] 代碼風格: ✅/❌
- [ ] 架構模式: ✅/❌
- [ ] 文檔完整: ✅/❌

## 優點
- ✅ [優點 1]
- ✅ [優點 2]

## 需要修改的項目
1. 🔴 **必須修改**: [項目]
2. 🟡 **建議修改**: [項目]
3. 🟢 **可選優化**: [項目]

## 總結建議
[最終建議和結論]
```

### Step 4: 運行自動檢查 (2 分鐘)

```bash
# 1. 運行測試
Bash: cd backend && pytest tests/unit/ -v --tb=short

# 2. 運行 linting
Bash: cd backend && flake8 [變更的文件]

# 3. 類型檢查
Bash: cd backend && mypy [變更的文件]

# 4. 安全掃描 (如可用)
Bash: bandit -r [變更的目錄]
```

---

## 📋 審查檢查清單

### 必查項目
- [ ] **功能正確**: 代碼實現了預期功能
- [ ] **無明顯 Bug**: 沒有邏輯錯誤
- [ ] **錯誤處理**: 適當處理異常情況
- [ ] **測試覆蓋**: 有適當的測試

### 重要項目
- [ ] **代碼可讀性**: 易於理解
- [ ] **命名清晰**: 變數和函數命名恰當
- [ ] **注釋適當**: 複雜邏輯有說明
- [ ] **DRY 原則**: 沒有重複代碼

### 進階項目
- [ ] **性能**: 無性能問題
- [ ] **安全**: 無安全漏洞
- [ ] **可維護性**: 易於修改
- [ ] **架構一致**: 符合項目架構

---

## ✅ 驗收標準

AI 助手完成審查後應提供：

1. **審查摘要**
   - 變更範圍和規模
   - 總體評價

2. **問題列表**
   - 按嚴重程度分類
   - 具體的修改建議

3. **測試驗證**
   - 測試覆蓋評估
   - 自動檢查結果

4. **改進建議**
   - 必須修改項
   - 可選優化項

---

## 🔗 相關文檔

### 開發流程指引
- [情況4: 功能開發](./SITUATION-4-FEATURE-DEVELOPMENT.md)
- [情況5: 測試執行](./SITUATION-5-TESTING.md)
- [情況7: 架構審查](./SITUATION-7-ARCHITECTURE-REVIEW.md)

### 品質規範
- `.claude/rules/code-quality.md` - 代碼品質規則
- `.claude/rules/testing.md` - 測試規則

---

**維護者**: AI 助手 + 開發團隊
**最後更新**: 2025-12-24
**版本**: 2.0
