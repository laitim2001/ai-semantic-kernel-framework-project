# Epic 2: 手動發票上傳與 AI 處理

> **建立日期**: 2025-12-17
> **完成日期**: 2025-12-18
> **狀態**: ✅ 已完成
> **優先級**: High

---

## 1. Epic 目標

### 主要目標
建立手動發票上傳流程，整合 Azure Document Intelligence OCR 和 GPT-4o 智能分類，實現三層映射系統的核心處理邏輯。

### 業務價值
- 自動化發票內容提取
- 智能術語分類與映射
- 減少人工數據輸入
- 提供信心度評估

### 成功定義
- 完成文件上傳界面
- 整合 OCR 提取服務
- 實現三層映射邏輯
- 建立信心度路由機制

---

## 2. Epic 範圍

### 包含功能（In Scope）

| Story | 名稱 | 描述 | 狀態 |
|-------|------|------|------|
| 2-1 | 文件上傳組件 | 拖放上傳與文件預覽 | ✅ |
| 2-2 | OCR 提取服務 | Azure Document Intelligence 整合 | ✅ |
| 2-3 | 三層映射引擎 | Universal → Forwarder → LLM 映射 | ✅ |
| 2-4 | 信心度計算 | 映射結果信心度評估 | ✅ |
| 2-5 | 處理結果展示 | 提取結果預覽與確認 | ✅ |

### 排除功能（Out of Scope）
- 批次處理（屬於 Epic 0）
- 人工審核工作流（屬於 Epic 3）

### 依賴項
- Azure Document Intelligence
- Azure OpenAI GPT-4o
- Epic 1 認證系統

---

## 3. 技術架構概覽

### 三層映射系統

```
┌─────────────────────────────────────────────────────────────────┐
│ TIER 1: Universal Mapping（通用層）                              │
│ • 覆蓋 70-80% 常見術語                                          │
│ • 所有 Forwarder 通用                                           │
├─────────────────────────────────────────────────────────────────┤
│ TIER 2: Forwarder-Specific Override（特定覆蓋層）                │
│ • 只記錄與通用規則「不同」的映射                                 │
├─────────────────────────────────────────────────────────────────┤
│ TIER 3: LLM Classification（AI 智能分類）                        │
│ • 當以上都無法匹配時使用 GPT-4o                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 信心度路由

| 信心度 | 處理方式 | 說明 |
|--------|---------|------|
| ≥ 90% | AUTO_APPROVE | 自動通過 |
| 70-89% | QUICK_REVIEW | 快速確認 |
| < 70% | FULL_REVIEW | 完整審核 |

---

## 4. 成功指標

| 指標 | 目標 | 實際 |
|------|------|------|
| OCR 提取準確率 | ≥ 95% | ✅ 達成 |
| 映射覆蓋率 | ≥ 90% | ✅ 達成 |
| 自動通過率 | ≥ 70% | ✅ 達成 |

---

## 5. 相關文檔

- PRD: `docs/01-planning/prd/prd.md`
- 架構設計: `docs/02-architecture/architecture.md`

---

**維護者**: Development Team
**最後更新**: 2025-12-26
