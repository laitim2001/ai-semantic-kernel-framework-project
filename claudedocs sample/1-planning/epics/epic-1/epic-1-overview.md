# Epic 1: 用戶認證與存取控制

> **建立日期**: 2025-12-17
> **完成日期**: 2025-12-18
> **狀態**: ✅ 已完成
> **優先級**: Critical

---

## 1. Epic 目標

### 主要目標
建立基於 Azure AD (Entra ID) 的企業級身份認證系統，實現單一登入 (SSO) 和角色型存取控制 (RBAC)。

### 業務價值
- 整合企業現有身份管理系統
- 確保數據安全與合規性
- 簡化用戶登入體驗
- 支援多角色權限管理

### 成功定義
- 成功整合 Azure AD SSO
- 實現角色權限驗證
- 建立 Session 管理機制
- 完成登入/登出流程

---

## 2. Epic 範圍

### 包含功能（In Scope）

| Story | 名稱 | 描述 | 狀態 |
|-------|------|------|------|
| 1-1 | Azure AD SSO 整合 | 實現 Azure AD 單一登入 | ✅ |
| 1-2 | 角色權限系統 | RBAC 角色與權限定義 | ✅ |
| 1-3 | Session 管理 | JWT Token 與 Session 處理 | ✅ |
| 1-4 | 登入頁面 | 用戶登入界面與錯誤處理 | ✅ |
| 1-5 | 權限中間件 | API 路由保護與權限驗證 | ✅ |

### 排除功能（Out of Scope）
- 多因素認證 (MFA) - 由 Azure AD 處理
- 用戶自助密碼重設 - 由 Azure AD 處理
- 社交登入整合

### 依賴項
- Azure AD (Entra ID) 租戶配置
- NextAuth.js
- JWT 處理庫

---

## 3. 技術架構概覽

### 認證流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    Azure AD SSO 流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [用戶] → [登入頁] → [Azure AD] → [Callback] → [Session]        │
│                                                                 │
│  Token 驗證 → 角色解析 → 權限檢查 → 授權訪問                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 角色定義

| 角色 | 權限範圍 |
|------|---------|
| ADMIN | 完整系統存取 |
| MANAGER | 管理審核與配置 |
| OPERATOR | 發票處理與審核 |
| VIEWER | 只讀存取 |

---

## 4. 成功指標

| 指標 | 目標 | 實際 |
|------|------|------|
| SSO 登入成功率 | ≥ 99% | ✅ 達成 |
| Token 驗證時間 | < 100ms | ✅ 達成 |
| 權限檢查準確率 | 100% | ✅ 達成 |

---

## 5. 相關文檔

- PRD: `docs/01-planning/prd/prd.md`
- 架構設計: `docs/02-architecture/architecture.md`

---

**維護者**: Development Team
**最後更新**: 2025-12-26
