# Epic 9: AI Assistant Integration - 需求分析文檔

> **狀態**: 📋 需求定義階段
> **優先級**: 🔥 高
> **關聯文檔**: [Epic 9 概覽](./epic-9-overview.md)

---

## 📋 需求概述

本文檔詳細定義 Epic 9 (AI Assistant Integration) 的功能需求、非功能需求、使用者場景、驗收標準等。

---

## 🎯 業務需求 (Business Requirements)

### BR-1: 提升預算規劃效率
**問題陳述**:
- PM 在創建預算提案時，不確定應該申請多少預算
- 需要查閱歷史專案資料、詢問同事，耗時且不準確

**業務目標**:
- 減少預算規劃時間 30%
- 提高預算估算準確度 (±15% 誤差範圍)
- 降低預算超支風險 20%

### BR-2: 簡化費用記錄流程
**問題陳述**:
- PM 記錄費用時需要手動選擇類別 (人力、軟體、硬體等)
- 類別選擇錯誤導致報表分析失真

**業務目標**:
- 減少費用記錄時間 40%
- 提高費用分類準確率至 85%+
- 降低重複修改次數 50%

### BR-3: 早期風險識別
**問題陳述**:
- Supervisor 只能在月底報表中發現預算超支
- 缺乏早期預警機制，無法及時干預

**業務目標**:
- 提前 2-4 週識別預算超支風險
- 風險預警準確率達 70%+
- 減少實際超支案例 30%

### BR-4: 自動化報表生成
**問題陳述**:
- Supervisor 需要手動撰寫每週/每月報表摘要
- 耗時且容易遺漏關鍵資訊

**業務目標**:
- 減少報表撰寫時間 60%
- 自動突出顯示異常事件和趨勢
- 生成自然語言摘要，提高可讀性

---

## 👤 使用者需求 (User Requirements)

### Story 9.1: 智能預算建議

**使用者角色**: Project Manager (PM)

**使用者故事**:
> 作為 PM，我希望在創建預算提案時，系統能基於歷史數據和專案特徵，自動建議合理的預算金額範圍，這樣我可以更快速且準確地完成預算規劃。

**功能需求**:

#### FR-9.1.1: 預算建議觸發
- **需求**: PM 在創建預算提案時，填寫專案基本資訊後，可點擊「獲取 AI 建議」按鈕
- **輸入**: 專案名稱、專案類型、預計時程、專案描述
- **輸出**: 建議預算金額範圍、信心區間、相似案例

**驗收標準**:
```gherkin
Given PM 在「創建預算提案」頁面
And 已填寫專案名稱、類型、時程、描述
When PM 點擊「獲取 AI 建議」按鈕
Then 系統應在 3 秒內顯示建議預算範圍
And 顯示信心區間 (例如: ±15%)
And 顯示 3 個相似歷史專案案例
And 建議準確度應達到 ±20% 誤差範圍內
```

#### FR-9.1.2: 建議結果展示
- **需求**: 清晰展示 AI 建議內容，包含解釋邏輯
- **展示內容**:
  - 建議金額範圍 (最小值、推薦值、最大值)
  - 信心區間 (例如: 75% 信心度)
  - 相似專案案例 (顯示 3 個最相似的歷史專案)
  - 建議理由 (自然語言解釋)

**驗收標準**:
```gherkin
Given AI 建議已生成
When 建議結果顯示在畫面上
Then 應顯示「推薦預算: $50,000 (範圍: $40,000 - $60,000)」
And 顯示「信心區間: ±15% (75% 信心度)」
And 顯示 3 個相似專案卡片 (專案名稱、實際預算、相似度分數)
And 顯示建議理由 (例如: "基於 5 個類似的軟體開發專案，平均預算為 $52,000")
```

#### FR-9.1.3: 相似案例檢視
- **需求**: PM 可以點擊相似案例，查看完整專案資訊
- **展示內容**: 專案名稱、類型、時程、實際預算、專案經理、完成狀態

**驗收標準**:
```gherkin
Given 相似專案案例已顯示
When PM 點擊其中一個案例卡片
Then 應開啟專案詳情 Modal
And 顯示完整專案資訊 (名稱、類型、時程、預算、負責人)
And 顯示相似度分數和匹配理由
```

#### FR-9.1.4: 建議採納/拒絕
- **需求**: PM 可以選擇採納或忽略 AI 建議
- **操作**:
  - 「採納建議」按鈕: 自動填入推薦金額到預算欄位
  - 「忽略建議」: 關閉建議卡片，手動輸入
  - 「調整建議」: 基於建議範圍手動調整

**驗收標準**:
```gherkin
Scenario: 採納建議
  Given AI 建議顯示推薦預算 $50,000
  When PM 點擊「採納建議」按鈕
  Then 預算欄位應自動填入 $50,000
  And 記錄採納事件到 Analytics

Scenario: 忽略建議
  Given AI 建議已顯示
  When PM 點擊「忽略建議」按鈕
  Then 建議卡片應消失
  And 記錄拒絕事件到 Analytics

Scenario: 調整建議
  Given AI 建議範圍 $40,000 - $60,000
  When PM 手動輸入 $45,000
  Then 系統應允許輸入
  And 記錄調整事件到 Analytics
```

---

### Story 9.2: 智能費用分類

**使用者角色**: Project Manager (PM)

**使用者故事**:
> 作為 PM，我希望在記錄費用時，系統能根據費用描述和金額，自動建議合適的費用類別，這樣我可以減少手動分類的時間和錯誤。

**功能需求**:

#### FR-9.2.1: 自動費用分類
- **需求**: PM 輸入費用描述後，系統自動建議費用類別
- **輸入**: 費用描述、金額、供應商 (可選)
- **輸出**: 建議類別、信心度、建議理由

**驗收標準**:
```gherkin
Given PM 在「記錄費用」頁面
When PM 輸入費用描述 "購買 Office 365 年度授權"
And 輸入金額 $5,000
Then 系統應在 1 秒內建議類別 "軟體授權"
And 顯示信心度 "92%"
And 顯示建議理由 "基於描述中的 'Office 365' 和 '授權' 關鍵字"
```

#### FR-9.2.2: 費用描述智能補全
- **需求**: 提供常見費用描述的自動補全
- **觸發**: PM 輸入 2 個字元後觸發
- **來源**: 歷史費用描述、常見模板

**驗收標準**:
```gherkin
Given PM 在費用描述欄位
When PM 輸入 "購買"
Then 系統應顯示補全建議列表
And 列表包含 "購買軟體授權", "購買硬體設備", "購買辦公用品"
And 點擊建議項目應自動填入欄位
```

#### FR-9.2.3: 異常費用檢測
- **需求**: 偵測金額或類別異常的費用
- **異常定義**:
  - 金額超過同類別平均值 2 倍
  - 類別與描述不匹配 (信心度 < 50%)
  - 重複費用 (相同描述、金額、時間接近)

**驗收標準**:
```gherkin
Scenario: 異常金額檢測
  Given PM 選擇類別 "辦公用品"
  When PM 輸入金額 $50,000 (遠高於平均值 $500)
  Then 系統應顯示警告 "此金額遠高於同類別平均值"
  And 建議覆核類別選擇

Scenario: 類別不匹配檢測
  Given PM 輸入描述 "購買 MacBook Pro"
  And 手動選擇類別 "軟體授權"
  Then 系統應顯示警告 "描述與類別可能不匹配"
  And 建議修改為 "硬體設備"

Scenario: 重複費用檢測
  Given 系統中存在費用 "Office 365 授權" $5,000 於 3 天前
  When PM 輸入相同描述和金額
  Then 系統應顯示警告 "偵測到可能的重複費用"
  And 顯示歷史費用連結
```

#### FR-9.2.4: 批量費用分類
- **需求**: 支援批量匯入費用並自動分類
- **輸入**: CSV 檔案 (描述、金額、日期)
- **輸出**: 自動分類結果、需要人工確認的項目

**驗收標準**:
```gherkin
Given PM 上傳包含 50 筆費用的 CSV 檔案
When 系統處理批量匯入
Then 應自動分類所有費用
And 顯示分類結果摘要 (例如: 45 筆自動分類, 5 筆需人工確認)
And 高信心度 (>80%) 的直接保存
And 低信心度 (<80%) 的標記為需確認
And 批量處理應在 30 秒內完成
```

---

### Story 9.3: 預測性風險預警

**使用者角色**: Supervisor

**使用者故事**:
> 作為 Supervisor，我希望系統能提前預警可能超支或延期的專案，這樣我可以及早介入並採取行動，避免問題惡化。

**功能需求**:

#### FR-9.3.1: 預算超支風險預測
- **需求**: 基於當前支出速度和專案進度，預測預算超支風險
- **輸入**: 專案預算、已使用金額、專案進度 (%)、剩餘時間
- **輸出**: 風險等級 (低/中/高)、預測超支金額、建議措施

**驗收標準**:
```gherkin
Given 專案「客戶關係系統」總預算 $100,000
And 已使用 $60,000 (60%)
And 專案進度 40% (剩餘 60% 工作)
And 剩餘時間 3 個月
When 系統執行風險預測
Then 應標記為「高風險」(紅色)
And 預測最終金額 $150,000 (超支 $50,000)
And 建議措施 "建議削減 Scope 或申請追加預算"
And 通知 Supervisor 和 PM
```

#### FR-9.3.2: 專案延期風險評估
- **需求**: 評估專案延期風險
- **輸入**: 計劃結束日期、當前進度、剩餘工作量、資源可用性
- **輸出**: 延期機率、預計延期時間、瓶頸識別

**驗收標準**:
```gherkin
Given 專案計劃於 2 個月後完成
And 當前進度 30% (預期應為 50%)
When 系統評估延期風險
Then 應標記「延期機率: 70%」
And 預計延期 1-2 個月
And 識別瓶頸 "開發資源不足"
And 建議措施 "考慮增加開發人力或調整時程"
```

#### FR-9.3.3: 資源瓶頸識別
- **需求**: 識別資源分配瓶頸
- **輸入**: 所有專案的資源使用情況
- **輸出**: 過度分配的資源、衝突時段、建議調整

**驗收標準**:
```gherkin
Given PM "張三" 同時負責 5 個專案
And 每個專案預計需要 20% 時間 (總計 100%)
When 系統分析資源瓶頸
Then 應警告 "PM 張三資源分配已滿"
And 建議 "考慮將部分專案轉移給其他 PM"
And 顯示資源使用時間線圖表
```

#### FR-9.3.4: 早期預警通知
- **需求**: 自動發送風險預警通知
- **觸發條件**:
  - 風險等級從「低」升至「中」或「高」
  - 預測超支金額超過 20%
  - 延期機率超過 60%
- **通知對象**: Supervisor + PM + 相關人員

**驗收標準**:
```gherkin
Given 專案「ERP 系統」風險等級升至「高」
When 系統偵測到風險變化
Then 應立即發送 Email 通知給 Supervisor 和 PM
And 應在系統內建立通知 (Notification Center)
And 通知內容包含: 專案名稱、風險類型、預測結果、建議措施
And 應記錄通知歷史到 Audit Log
```

---

### Story 9.4: 自動報表摘要

**使用者角色**: Supervisor

**使用者故事**:
> 作為 Supervisor，我希望系統能自動生成每週/每月報表摘要，用自然語言突出關鍵指標和異常事件，這樣我可以快速了解整體狀況而不需要逐項查看。

**功能需求**:

#### FR-9.4.1: 自動摘要生成
- **需求**: 定期自動生成報表摘要
- **觸發**: 每週一早上 9:00、每月 1 號早上 9:00
- **內容**:
  - 整體狀況 (專案數量、預算使用率、風險專案數)
  - 關鍵趨勢 (與上週/上月對比)
  - 異常事件 (超支、延期、新風險)
  - 建議行動項目

**驗收標準**:
```gherkin
Given 今天是週一早上 9:00
When 系統執行自動報表生成
Then 應生成本週摘要報表
And 摘要包含:
  - "本週共有 15 個進行中專案 (↑2)"
  - "總預算使用率 72% (↑5%)"
  - "3 個高風險專案需關注"
And 應發送 Email 給所有 Supervisor
And 應在 Dashboard 顯示摘要卡片
```

#### FR-9.4.2: 關鍵指標趨勢分析
- **需求**: 自動識別關鍵指標趨勢
- **分析指標**:
  - 預算使用率趨勢
  - 專案完成率趨勢
  - 費用支出趨勢
  - 風險專案數量趨勢

**驗收標準**:
```gherkin
Given 系統分析過去 4 週的數據
When 生成趨勢分析
Then 應生成自然語言摘要:
  - "預算使用率持續上升 (+15%/月), 需注意超支風險"
  - "專案完成率下降 (-10%), 建議檢視資源分配"
And 應生成視覺化圖表 (折線圖、長條圖)
```

#### FR-9.4.3: 異常事件突出顯示
- **需求**: 自動突出顯示需要關注的異常事件
- **異常定義**:
  - 新增高風險專案
  - 預算超支超過 20%
  - 專案延期超過 1 個月
  - 費用異常增長 (>50% 單週增長)

**驗收標準**:
```gherkin
Given 專案「CRM 系統」本週新增為高風險
When 生成報表摘要
Then 應在「異常事件」區塊突出顯示:
  - "⚠️ 專案 'CRM 系統' 預測超支 $30,000 (30%)"
  - "建議措施: 與 PM 確認 Scope 調整可能性"
And 異常事件應排在摘要最前面
And 應使用警告色標示 (紅色/橙色)
```

#### FR-9.4.4: 自然語言報表生成
- **需求**: 使用自然語言生成可讀性高的報表
- **語言風格**: 專業、簡潔、可執行
- **包含元素**:
  - 執行摘要 (3-5 句話)
  - 關鍵指標列表
  - 趨勢分析段落
  - 異常事件列表
  - 建議行動項目

**驗收標準**:
```gherkin
Given 系統生成報表摘要
Then 摘要應使用自然語言撰寫
And 執行摘要範例:
  "本週 IT 部門共執行 15 個專案, 總預算使用率達 72%。
   相較上週增加 5%, 主要來自 'ERP 升級' 專案的硬體採購。
   目前有 3 個高風險專案需要關注, 建議本週內與相關 PM 確認狀況。"
And 報表應包含具體數字和變化趨勢
And 報表應提供可執行的建議
```

---

## 🎨 使用者介面需求 (UI/UX Requirements)

### UI-1: AI 建議卡片設計
- **位置**: 創建預算提案頁面右側 Sidebar
- **視覺設計**:
  - 淺藍色背景 (#F0F8FF)
  - 機器人圖示 🤖
  - 「AI 建議」標題
  - Loading 動畫 (處理中)
  - 成功/錯誤狀態視覺回饋
- **互動設計**:
  - 可摺疊/展開
  - Hover 顯示詳細資訊
  - 點擊相似案例開啟 Modal

### UI-2: 風險預警 Badge
- **位置**: Dashboard 專案卡片、專案列表
- **視覺設計**:
  - 低風險: 綠色 Badge "低風險"
  - 中風險: 橙色 Badge "中風險 ⚠️"
  - 高風險: 紅色 Badge "高風險 🚨"
  - 動畫: 高風險項目緩慢閃爍
- **互動設計**:
  - Hover 顯示風險詳情 Tooltip
  - 點擊開啟風險分析 Modal

### UI-3: 報表摘要 Dashboard
- **位置**: Supervisor Dashboard 頂部
- **視覺設計**:
  - 卡片式佈局
  - 關鍵指標大字顯示
  - 趨勢箭頭 (↑/↓)
  - 異常事件使用警告色
- **互動設計**:
  - 點擊指標卡片展開詳細資訊
  - 點擊異常事件跳轉到相關專案

### UI-4: AI 處理透明度
- **原則**: 所有 AI 功能應清楚標示，讓使用者了解背後邏輯
- **實作**:
  - 顯示「AI 建議」標籤
  - 提供「為什麼這樣建議?」連結
  - 顯示信心度分數
  - 允許手動覆寫 AI 建議

---

## ⚙️ 非功能需求 (Non-Functional Requirements)

### NFR-1: 效能需求 (Performance)

| 指標 | 需求 | 測量方式 |
|------|------|----------|
| AI 建議回應時間 | P95 < 3 秒 | Azure Monitor |
| 費用分類速度 | < 1 秒 | 前端效能追蹤 |
| 風險預測回應時間 | < 5 秒 | API 回應時間 |
| 報表生成時間 | < 10 秒 | 背景任務監控 |
| 快取命中率 | ≥ 40% | Redis metrics |

### NFR-2: 可用性需求 (Availability)

| 指標 | 需求 | 備註 |
|------|------|------|
| AI API 可用性 | ≥ 99.5% | 使用 Azure OpenAI SLA |
| 降級策略 | 必須 | AI 失敗時顯示錯誤，系統其他功能正常 |
| 快取備援 | 必須 | AI 服務中斷時，優先返回快取結果 |

### NFR-3: 安全性需求 (Security)

| 需求 | 說明 |
|------|------|
| 資料隱私 | 使用 Azure OpenAI，確保資料不外流 |
| 敏感資料遮罩 | 傳送給 AI 的資料須去除個人識別資訊 (PII) |
| API 金鑰管理 | 使用 Azure Key Vault 儲存 API 金鑰 |
| 存取控制 | 僅限已認證使用者存取 AI 功能 |
| Audit Log | 記錄所有 AI API 呼叫、使用者採納/拒絕行為 |

### NFR-4: 可擴展性需求 (Scalability)

| 需求 | 說明 |
|------|------|
| 並發處理 | 支援 100 個並發 AI 請求 |
| 流量控制 | 實施 Rate Limiting (每使用者 10 次/分鐘) |
| 成本控制 | 每月 AI API 成本不超過 $100 (初期) |
| 資料增長 | 支援歷史資料增長至 10,000+ 專案 |

### NFR-5: 可維護性需求 (Maintainability)

| 需求 | 說明 |
|------|------|
| Prompt 版本管理 | 所有 AI Prompt 須版本控制 |
| A/B 測試能力 | 支援不同 Prompt 版本的 A/B 測試 |
| 監控與告警 | 監控 AI API 錯誤率、回應時間、成本 |
| 降級開關 | 支援動態關閉 AI 功能 (Feature Flag) |

### NFR-6: 可用性需求 (Usability)

| 需求 | 說明 |
|------|------|
| 學習曲線 | 新使用者應在 5 分鐘內理解 AI 功能 |
| 透明度 | 所有 AI 建議應清楚說明邏輯 |
| 控制權 | 使用者可自由選擇採納或拒絕 AI 建議 |
| 錯誤訊息 | 提供友善的錯誤訊息和解決建議 |

---

## 🧪 驗收標準 (Acceptance Criteria)

### Story 9.1: 智能預算建議

- [ ] PM 可以在創建預算提案時點擊「獲取 AI 建議」
- [ ] 系統應在 3 秒內返回建議預算範圍
- [ ] 建議準確度應達到 ±20% 誤差範圍內 (測試 50 個歷史案例)
- [ ] 應顯示至少 3 個相似歷史專案案例
- [ ] PM 可以選擇採納、拒絕或調整建議
- [ ] 系統應記錄使用者行為到 Analytics
- [ ] AI 建議採納率應達 40%+ (上線 1 個月後)

### Story 9.2: 智能費用分類

- [ ] PM 輸入費用描述後，系統應在 1 秒內建議類別
- [ ] 費用分類準確率應達 85%+ (測試 200 筆歷史費用)
- [ ] 系統應偵測異常費用 (金額、類別不匹配、重複)
- [ ] 支援批量匯入費用並自動分類 (50 筆 < 30 秒)
- [ ] 低信心度 (<80%) 的分類應標記為需人工確認
- [ ] 費用記錄時間應減少 30%+ (使用者測試)

### Story 9.3: 預測性風險預警

- [ ] 系統應每日自動執行風險預測 (凌晨 2:00)
- [ ] 風險預警準確率應達 70%+ (回測 3 個月歷史資料)
- [ ] 高風險專案應立即通知 Supervisor 和 PM
- [ ] 風險等級變化應記錄到 Audit Log
- [ ] Dashboard 應顯示所有專案的風險等級 Badge
- [ ] 預算超支預測準確度應達 ±25% (回測驗證)

### Story 9.4: 自動報表摘要

- [ ] 系統應每週一、每月 1 號自動生成報表摘要
- [ ] 報表應包含執行摘要、關鍵指標、趨勢分析、異常事件
- [ ] 報表生成時間應 < 10 秒
- [ ] 報表應自動發送 Email 給所有 Supervisor
- [ ] 報表摘要應顯示在 Dashboard 頂部
- [ ] Supervisor 滿意度應達 4.0/5.0+ (問卷調查)

---

## 📊 優先級排序 (Prioritization)

### P0 (Must Have - MVP)

1. **FR-9.1.1**: 預算建議觸發 (核心價值)
2. **FR-9.2.1**: 自動費用分類 (高頻使用)
3. **FR-9.3.1**: 預算超支風險預測 (業務關鍵)

### P1 (Should Have)

1. **FR-9.1.2**: 建議結果展示
2. **FR-9.2.3**: 異常費用檢測
3. **FR-9.3.4**: 早期預警通知
4. **FR-9.4.1**: 自動摘要生成

### P2 (Could Have)

1. **FR-9.1.3**: 相似案例檢視
2. **FR-9.2.2**: 費用描述智能補全
3. **FR-9.3.2**: 專案延期風險評估
4. **FR-9.4.2**: 關鍵指標趨勢分析

### P3 (Nice to Have)

1. **FR-9.2.4**: 批量費用分類
2. **FR-9.3.3**: 資源瓶頸識別
3. **FR-9.4.3**: 異常事件突出顯示
4. **FR-9.4.4**: 自然語言報表生成

---

## 🔗 相關文檔

- [Epic 9 概覽](./epic-9-overview.md)
- [Epic 9 技術架構](./epic-9-architecture.md)
- [Epic 9 風險分析](./epic-9-risks.md)
- [詳細用戶故事 (docs/stories/epic-9/)](../../../docs/stories/epic-9/)

---

## 📝 變更歷史

| 日期 | 版本 | 變更內容 | 作者 |
|------|------|---------|------|
| 2025-11-08 | 1.0 | 初始版本 - Epic 9 需求分析 | AI Assistant |

---

**維護者**: 產品團隊 + 開發團隊
**最後更新**: 2025-11-08
**審核狀態**: 待審核
