# FEAT-OM-SUMMARY: O&M Summary é é¢

> **åŠŸèƒ½åç¨±**: O&M Summary é é¢
> **å»ºç«‹æ—¥æœŸ**: 2025-11-29
> **ç‹€æ…‹**: ğŸ“‹ è¨­è¨ˆå®Œæˆï¼Œå¾…é–‹ç™¼
> **å„ªå…ˆç´š**: High
> **é ä¼°å·¥æ™‚**: 3-4 å¤©

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 èƒŒæ™¯
å…§å®¹äººå“¡ä»¥å‰ä½¿ç”¨ Excel æ–‡ä»¶ç®¡ç† O&M é …ç›®ã€‚ç¾æœ‰ç³»çµ±é›–ç„¶æœ‰ O&M Expenses é é¢å¯ä»¥ç®¡ç†ï¼ˆæ–°å¢ã€ç·¨è¼¯ï¼‰O&M é …ç›®ï¼Œä½†ç¼ºå°‘ä¸€å€‹é¡ä¼¼ Excel çš„ç¸½è¦½é é¢ï¼Œè®“ç”¨æˆ¶å¯ä»¥ï¼š
- ä¸€ç›®äº†ç„¶åœ°çœ‹åˆ°å„ OpCoã€å„ Category çš„é ç®—å’Œå¯¦éš›æ”¯å‡º
- æ¯”è¼ƒå¹´åº¦é ç®—èˆ‡ä¸Šå¹´åº¦å¯¦éš›æ”¯å‡ºçš„è®ŠåŒ–
- å¿«é€Ÿäº†è§£ç¶­è­·åˆ°æœŸæ—¥æœŸ

### 1.2 ç›®æ¨™
æä¾›ä¸€å€‹è¡¨æ ¼æ¨£å¼çš„ O&M Summary é é¢ï¼Œæ”¯æ´ï¼š
- å¤šé¸ OpCo å’Œ Category éæ¿¾
- é¡¯ç¤ºé ç®— (Budget) å’Œå¯¦éš›æ”¯å‡º (Actual) çš„å°æ¯”
- è¨ˆç®—å¹´å¢ç‡ (Change %)
- é¡¯ç¤ºç¶­è­·åˆ°æœŸæ—¥ (Maintenance End Date)
- éšå±¤å¼åˆ†çµ„é¡¯ç¤ºï¼ˆCategory â†’ OpCo â†’ Itemsï¼‰

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 éæ¿¾å™¨å€åŸŸ

| éæ¿¾å™¨ | é¡å‹ | èªªæ˜ |
|--------|------|------|
| **Financial Year** | å–®é¸ä¸‹æ‹‰ | é¸æ“‡ç•¶å‰å¹´åº¦ï¼ˆå¦‚ FY2026ï¼‰ï¼Œç”¨æ–¼é¡¯ç¤º Budget |
| **OpCos** | å¤šé¸ä¸‹æ‹‰ | é¸æ“‡ä¸€å€‹æˆ–å¤šå€‹ OpCoï¼Œé è¨­å…¨é¸ |
| **O&M Category** | å¤šé¸ä¸‹æ‹‰ | é¸æ“‡ä¸€å€‹æˆ–å¤šå€‹é¡åˆ¥ï¼Œé è¨­å…¨é¸ |
| **"Reset" æŒ‰éˆ•** | å‹•ä½œæŒ‰éˆ• | é‡ç½®æ‰€æœ‰éæ¿¾å™¨ç‚ºé è¨­å€¼ |

### 2.2 é¡åˆ¥åŒ¯ç¸½è¡¨æ ¼ (Summary Grid)

**æ¬„ä½å®šç¾©ï¼š**

| æ¬„ä½ | èªªæ˜ | è¨ˆç®—æ–¹å¼ |
|------|------|----------|
| O&M Category | é¡åˆ¥åç¨± | å¾ OMExpense.category å–å¾— |
| FY26 Budget | ç•¶å‰å¹´åº¦é ç®— | SUM(budgetAmount) WHERE financialYear = ç•¶å‰å¹´åº¦ |
| FY25 Actual | ä¸Šå¹´åº¦å¯¦éš›æ”¯å‡º | SUM(actualSpent) WHERE financialYear = ç•¶å‰å¹´åº¦ - 1 |
| Change % | å¹´å¢ç‡ | ((FY26 Budget - FY25 Actual) / FY25 Actual) * 100 |
| Item Count | é …ç›®æ•¸é‡ | COUNT(OMExpense) |

**è¡¨æ ¼çµæ§‹ï¼š**
```
+----------------+-------------+-------------+----------+------------+
| O&M Category   | FY26 Budget | FY25 Actual | Change % | Item Count |
+----------------+-------------+-------------+----------+------------+
| Data Lines     | $xxx        | $xxx        | +5.0%    | 12         |
| Hardware       | $xxx        | $xxx        | -2.0%    | 8          |
| Software       | $xxx        | $xxx        | +10.0%   | 15         |
| App System     | $xxx        | $xxx        | +3.0%    | 6          |
| Network        | $xxx        | $xxx        | 0.0%     | 10         |
+----------------+-------------+-------------+----------+------------+
| Sub Total      | $xxx        | $xxx        | +4.0%    | 51         |
+----------------+-------------+-------------+----------+------------+
```

### 2.3 é …ç›®æ˜ç´°è¡¨æ ¼ (Detail Grid)

**éšå±¤çµæ§‹ï¼ˆå¤šé¸ OpCo æ™‚ï¼‰ï¼š**
1. **Level 1: O&M Category** - æŒ‰é¡åˆ¥åˆ†çµ„
2. **Level 2: OpCo** - æŒ‰ç‡Ÿé‹å…¬å¸åˆ†çµ„
3. **Level 3: O&M Items** - å¯¦éš›é …ç›®åˆ—è¡¨
4. **Sub Totals** - æ¯å€‹ OpCo å’Œ Category çš„å°è¨ˆ

**æ¬„ä½å®šç¾©ï¼š**

| æ¬„ä½ | èªªæ˜ | è³‡æ–™ä¾†æº |
|------|------|----------|
| O&M Item | é …ç›®åç¨± | OMExpense.name |
| Description | é …ç›®æè¿° | OMExpense.description |
| FY26 Budget | ç•¶å‰å¹´åº¦é ç®— | OMExpense.budgetAmount |
| FY25 Actual | ä¸Šå¹´åº¦å¯¦éš›æ”¯å‡º | æŸ¥è©¢ä¸Šå¹´åº¦åŒé …ç›®çš„ actualSpent |
| Change % | å¹´å¢ç‡ | è¨ˆç®—å…¬å¼åŒä¸Š |
| End Date | ç¶­è­·åˆ°æœŸæ—¥ | OMExpense.endDate |

**è¦–è¦ºçµæ§‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ O&M Category: Data Lines                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‚ OpCos - RHK                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ O&M Item         â”‚ FY26 Budget â”‚ FY25 Actual â”‚ Change%â”‚ End Date  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. R-WAN         â”‚ $10,000     â”‚ $9,500      â”‚ +5.3%  â”‚ 2026/12/31â”‚
â”‚    (WANé€£ç·šè²»ç”¨)  â”‚             â”‚             â”‚        â”‚           â”‚
â”‚ 2. SD-WAN        â”‚ $15,000     â”‚ $14,000     â”‚ +7.1%  â”‚ 2026/06/30â”‚
â”‚    (è»Ÿé«”å®šç¾©ç¶²è·¯) â”‚             â”‚             â”‚        â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Sub Total     â”‚ $25,000     â”‚ $23,500     â”‚ +6.4%  â”‚ -         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‚ OpCos - RTH                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Fiber Link    â”‚ $8,000      â”‚ $7,500      â”‚ +6.7%  â”‚ 2026/03/31â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Sub Total     â”‚ $8,000      â”‚ $7,500      â”‚ +6.7%  â”‚ -         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Category Totalâ”‚ $33,000     â”‚ $31,000     â”‚ +6.5%  â”‚ -         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æŠ€è¡“è¨­è¨ˆ

### 3.1 æ–°å¢ API Procedure

```typescript
// packages/api/src/routers/omExpense.ts

/**
 * ç²å– O&M Summary æ•¸æ“š
 * æ”¯æ´è·¨å¹´åº¦æ¯”è¼ƒ
 */
getSummary: protectedProcedure
  .input(z.object({
    currentYear: z.number().int(),      // ç•¶å‰å¹´åº¦ï¼ˆé¡¯ç¤º Budgetï¼‰
    previousYear: z.number().int(),     // ä¸Šå¹´åº¦ï¼ˆé¡¯ç¤º Actualï¼‰
    opCoIds: z.array(z.string()).optional(),    // å¯é¸éæ¿¾
    categories: z.array(z.string()).optional(), // å¯é¸éæ¿¾
  }))
  .query(async ({ ctx, input }) => {
    // è¿”å›çµæ§‹è¦‹ä¸‹æ–¹
  })
```

**è¿”å›çµæ§‹ï¼š**
```typescript
interface OMSummaryResponse {
  // åŒ¯ç¸½æ•¸æ“š
  categorySummary: {
    category: string;
    currentYearBudget: number;
    previousYearActual: number;
    changePercent: number | null;
    itemCount: number;
  }[];

  // æ˜ç´°æ•¸æ“šï¼ˆæŒ‰ Category -> OpCo -> Items åˆ†çµ„ï¼‰
  detailData: {
    category: string;
    opCoGroups: {
      opCoId: string;
      opCoCode: string;
      opCoName: string;
      items: {
        id: string;
        name: string;
        description: string | null;
        currentYearBudget: number;
        previousYearActual: number | null;
        changePercent: number | null;
        endDate: Date;
      }[];
      subTotal: {
        currentYearBudget: number;
        previousYearActual: number;
        changePercent: number | null;
      };
    }[];
    categoryTotal: {
      currentYearBudget: number;
      previousYearActual: number;
      changePercent: number | null;
    };
  }[];

  // ç¸½è¨ˆ
  grandTotal: {
    currentYearBudget: number;
    previousYearActual: number;
    changePercent: number | null;
    itemCount: number;
  };
}
```

### 3.2 é é¢çµæ§‹

```
apps/web/src/
â”œâ”€â”€ app/[locale]/
â”‚   â””â”€â”€ om-summary/
â”‚       â””â”€â”€ page.tsx           # ä¸»é é¢
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ om-summary/
â”‚       â”œâ”€â”€ OMSummaryFilters.tsx       # éæ¿¾å™¨çµ„ä»¶
â”‚       â”œâ”€â”€ OMSummaryCategoryGrid.tsx  # é¡åˆ¥åŒ¯ç¸½è¡¨æ ¼
â”‚       â”œâ”€â”€ OMSummaryDetailGrid.tsx    # é …ç›®æ˜ç´°è¡¨æ ¼
â”‚       â””â”€â”€ index.ts
```

### 3.3 I18N Keys

```json
// apps/web/src/messages/zh-TW.json
{
  "omSummary": {
    "title": "O&M è²»ç”¨ç¸½è¦½",
    "filters": {
      "financialYear": "è²¡å‹™å¹´åº¦",
      "opCos": "ç‡Ÿé‹å…¬å¸",
      "categories": "O&M é¡åˆ¥",
      "reset": "é‡ç½®",
      "selectAll": "å…¨é¸"
    },
    "summaryGrid": {
      "title": "é¡åˆ¥åŒ¯ç¸½",
      "category": "O&M é¡åˆ¥",
      "currentBudget": "FY{year} é ç®—",
      "previousActual": "FY{year} å¯¦éš›",
      "changePercent": "è®ŠåŒ– %",
      "itemCount": "é …ç›®æ•¸"
    },
    "detailGrid": {
      "title": "é …ç›®æ˜ç´°",
      "item": "O&M é …ç›®",
      "description": "æè¿°",
      "endDate": "åˆ°æœŸæ—¥",
      "subTotal": "å°è¨ˆ",
      "categoryTotal": "é¡åˆ¥ç¸½è¨ˆ"
    },
    "totals": {
      "grandTotal": "ç¸½è¨ˆ"
    }
  }
}
```

---

## 4. é–‹ç™¼è¨ˆåŠƒ

### Phase 1: å¾Œç«¯ API (1 å¤©)

| ä»»å‹™ | èªªæ˜ | é ä¼°æ™‚é–“ |
|------|------|----------|
| 1.1 | æ–°å¢ `getSummary` procedure | 2 å°æ™‚ |
| 1.2 | å¯¦ç¾è·¨å¹´åº¦æ¯”è¼ƒé‚è¼¯ | 2 å°æ™‚ |
| 1.3 | å¯¦ç¾åˆ†çµ„åŒ¯ç¸½é‚è¼¯ | 2 å°æ™‚ |
| 1.4 | å–®å…ƒæ¸¬è©¦ | 1 å°æ™‚ |

### Phase 2: å‰ç«¯çµ„ä»¶ (1.5 å¤©)

| ä»»å‹™ | èªªæ˜ | é ä¼°æ™‚é–“ |
|------|------|----------|
| 2.1 | `OMSummaryFilters` çµ„ä»¶ | 2 å°æ™‚ |
| 2.2 | `OMSummaryCategoryGrid` çµ„ä»¶ | 3 å°æ™‚ |
| 2.3 | `OMSummaryDetailGrid` çµ„ä»¶ | 4 å°æ™‚ |
| 2.4 | ä¸»é é¢æ•´åˆ | 2 å°æ™‚ |

### Phase 3: I18N å’Œæ¨£å¼ (0.5 å¤©)

| ä»»å‹™ | èªªæ˜ | é ä¼°æ™‚é–“ |
|------|------|----------|
| 3.1 | æ–°å¢ç¿»è­¯ keys (en + zh-TW) | 1 å°æ™‚ |
| 3.2 | éŸ¿æ‡‰å¼æ¨£å¼èª¿æ•´ | 2 å°æ™‚ |
| 3.3 | æ•¸å­—æ ¼å¼åŒ–ï¼ˆé‡‘é¡ã€ç™¾åˆ†æ¯”ï¼‰| 1 å°æ™‚ |

### Phase 4: æ¸¬è©¦å’Œå„ªåŒ– (1 å¤©)

| ä»»å‹™ | èªªæ˜ | é ä¼°æ™‚é–“ |
|------|------|----------|
| 4.1 | æ‰‹å‹•åŠŸèƒ½æ¸¬è©¦ | 2 å°æ™‚ |
| 4.2 | é‚Šç•Œæƒ…æ³è™•ç† | 2 å°æ™‚ |
| 4.3 | æ€§èƒ½å„ªåŒ– | 2 å°æ™‚ |
| 4.4 | æ›´æ–°å´é‚Šæ¬„å°èˆª | 1 å°æ™‚ |

---

## 5. é©—æ”¶æ¨™æº–

### 5.1 åŠŸèƒ½é©—æ”¶
- [ ] éæ¿¾å™¨å¯å¤šé¸ OpCo å’Œ Category
- [ ] é¡åˆ¥åŒ¯ç¸½è¡¨æ ¼æ­£ç¢ºé¡¯ç¤º Budgetã€Actualã€Change%
- [ ] æ˜ç´°è¡¨æ ¼æŒ‰ Category â†’ OpCo â†’ Items æ­£ç¢ºåˆ†çµ„
- [ ] å°è¨ˆå’Œç¸½è¨ˆè¨ˆç®—æ­£ç¢º
- [ ] å¹´å¢ç‡è¨ˆç®—æ­£ç¢ºï¼ˆè™•ç†é™¤ä»¥é›¶æƒ…æ³ï¼‰
- [ ] æ—¥æœŸæ ¼å¼æ­£ç¢ºé¡¯ç¤º

### 5.2 æŠ€è¡“é©—æ”¶
- [ ] TypeScript ç„¡éŒ¯èª¤
- [ ] ESLint ç„¡è­¦å‘Š
- [ ] I18N å®Œæ•´ï¼ˆen + zh-TWï¼‰
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆï¼ˆæ¡Œé¢ + å¹³æ¿ï¼‰
- [ ] è¼‰å…¥ç‹€æ…‹å’ŒéŒ¯èª¤è™•ç†

### 5.3 ç”¨æˆ¶é«”é©—
- [ ] è¡¨æ ¼å¯è®€æ€§è‰¯å¥½
- [ ] æ•¸å­—æ ¼å¼åŒ–ï¼ˆåƒåˆ†ä½ã€è²¨å¹£ç¬¦è™Ÿï¼‰
- [ ] ç™¾åˆ†æ¯”é¡è‰²å€åˆ†ï¼ˆæ­£å€¼ç¶ è‰²ã€è² å€¼ç´…è‰²ï¼‰
- [ ] å°èˆªæ¬„å·²æ›´æ–°

---

## 6. ç›¸é—œæ–‡æª”

- [ç¾æœ‰ O&M Expenses é é¢](../../apps/web/src/app/[locale]/om-expenses/page.tsx)
- [OMExpense Router](../../packages/api/src/routers/omExpense.ts)
- [Prisma Schema - OMExpense](../../packages/db/prisma/schema.prisma)

---

**å»ºç«‹è€…**: AI Assistant
**æœ€å¾Œæ›´æ–°**: 2025-11-29
